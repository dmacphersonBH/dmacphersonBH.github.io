<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>iHUB Sketch 4: Infinite Silence</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <style>
    body, html { margin: 0; padding: 0; overflow: hidden; background: #000; }
    canvas { display: block; }
  </style>
</head>
<body>
<script>
// --- CONFIGURATION ---
var numLines = 60;       // Higher number = sharper text definition
var amplitude = 30;      // Height of the waves
var noiseScale = 0.005;  // Zoom level of the noise
var speed = 0.0001;       // Speed of the flow

// --- GLOBALS ---
var pg; 

function setup() {
  createCanvas(windowWidth, windowHeight);
  colorMode(GRAY, 255); // Greyscale Mode
  pixelDensity(1);
  
  // 1. CREATE THE INVISIBLE MAP
  pg = createGraphics(width, height);
  pg.pixelDensity(1);
  pg.background(0); // Black background
  pg.fill(255);     // White Text
  pg.noStroke();
  pg.textAlign(CENTER, CENTER);
  pg.textStyle(BOLD);
  pg.textFont('sans-serif');
  pg.textSize(min(width, height) * 0.75); // Large text
  pg.text("iHUB", width / 2, height / 2);
  
  // Load pixels into memory so we can check them fast
  pg.loadPixels();
}

function draw() {
  background(0); // Dark Charcoal Background
  noFill();

  // Time based on system clock
  let t = millis() * speed;

  strokeWeight(1.5);
  
  for (let i = 0; i < numLines; i++) {
    // Calculate the base Y position for this line
    let yBase = map(i, 0, numLines, -height * 0.15, height );
    
    // Aesthetic: Lighter lines at bottom, darker at top
    let lineBrightness = map(i, 0, numLines, 30, 30);
    stroke(lineBrightness, 180);

    beginShape();
    
    // Iterate across the width of the screen
    for (let x = 0; x <= width; x += 10) { // Step by 10px
      
      // 1. CALCULATE THE WAVE (Noise + Sine)
      let n = noise(x * noiseScale, i * 0.2, t);
      let s = sin(x * 0.002 + t * 5);
      let rawOffset = (n * amplitude) + (s * amplitude * 0.5);

      // 2. CHECK THE MAP
      let px = floor(x);
      let py = floor(yBase);
      
      let textInfluence = 0; 
      
      // Look up the pixel brightness in our hidden buffer
      if (px >= 0 && px < width && py >= 0 && py < height) {
        let index = (px + py * width) * 4;
        let brightness = pg.pixels[index]; 
        
        // Normalize 0-255 to 0.0-1.0
        textInfluence = brightness / 255.0; 
      }

      // 3. APPLY LOGIC
      // If we are IN text (Influence = 1), move offset to 0.
      // If we are OUT of text (Influence = 0), keep offset as is.
      let finalOffset = rawOffset * (1.0 - textInfluence);

      vertex(x, yBase + finalOffset);
    }
    endShape();
  }
}

function windowResized() {
  resizeCanvas(windowWidth, windowHeight);
  setup(); // Re-generate map on resize to fit new screen
}
</script>
</body>
</html>